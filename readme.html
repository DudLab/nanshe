

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>README &mdash; nanshe 0.1.0a29+7.gc825354 documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0a29+7.gc825354',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="top" title="nanshe 0.1.0a29+7.gc825354 documentation" href="index.html" />
    <link rel="next" title="nanshe package" href="nanshe.html" />
    <link rel="prev" title="Welcome to nanshe’s documentation!" href="index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.html" title="nanshe package"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Welcome to nanshe’s documentation!"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">nanshe 0.1.0a29+7.gc825354 documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="readme">
<h1>README<a class="headerlink" href="#readme" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://travis-ci.org/jakirkham/nanshe"><img alt="Travis Build Status" src="https://travis-ci.org/jakirkham/nanshe.svg?branch=master" /></a> <a class="reference external" href="https://app.wercker.com/project/bykey/1ed421adbbec48aac2a370817dc0410f"><img alt="Wercker Build Status" src="https://app.wercker.com/status/1ed421adbbec48aac2a370817dc0410f/s/master" /></a> <a class="reference external" href="https://coveralls.io/r/jakirkham/nanshe?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/jakirkham/nanshe/badge.svg?branch=master" /></a> <a class="reference external" href="https://landscape.io/github/jakirkham/nanshe/master"><img alt="Code Health" src="https://landscape.io/github/jakirkham/nanshe/master/landscape.svg?style=flat" /></a> <a class="reference external" href="https://www.gnu.org/copyleft/gpl.html"><img alt="License" src="http://img.shields.io/badge/license-GPLv3-blue.svg" /></a> <a class="reference external" href="http://jakirkham.github.io/nanshe/"><img alt="Documentation" src="https://img.shields.io/badge/docs-current-9F21E9.svg" /></a> <a class="reference external" href="https://anaconda.org/jakirkham/nanshe"><img alt="Binstar Release" src="https://anaconda.org/jakirkham/nanshe/badges/version.svg" /></a></p>
<hr class="docutils" />
<div class="section" id="nanshe">
<h2>Nanshe<a class="headerlink" href="#nanshe" title="Permalink to this headline">¶</a></h2>
<div class="section" id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h3>
<p>This package is designed to perform segmentation on datasets containing
spatially-fixed components with time varying intensity. As the
techniques used are a bit slow, the segmentation algorithm has been
designed to run in batch. The segmentation algorithm has been further
tailored to enable multiprocessing as well as support for clusters that
support DRMAA ( <a class="reference external" href="http://www.drmaa.org">http://www.drmaa.org</a> ). In addition to the segmentation
algorithm, it provides a converter for TIFF to HDF5 and a rough viewer
for inspecting the results obtained.</p>
</div>
<div class="section" id="converter">
<h3>Converter<a class="headerlink" href="#converter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="intro">
<h4>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h4>
<p>The first item contained inside the package is <code class="docutils literal"><span class="pre">nanshe_converter.py</span></code>.
This is designed to convert external formats to HDF5 (the native format
used by Nanshe). Currently, only TIFF stacks are supported.</p>
</div>
<div class="section" id="sample-usage">
<h4>Sample Usage<a class="headerlink" href="#sample-usage" title="Permalink to this headline">¶</a></h4>
<p>To run the converter, simply run the command below. The first argument
specifies the input format. Currently, this is just tiff. The
configuration parameters are contained in the <code class="docutils literal"><span class="pre">config.json</span></code> file. An
example configuration file can be found in the <code class="docutils literal"><span class="pre">examples</span></code> folder. The
input images can be specified using a regex as can be seen below. The
output file is an HDF5 with a dataset containing the result. Here,
<code class="docutils literal"><span class="pre">output.h5</span></code> is the output file. The data is stored in the specified
dataset, which is <code class="docutils literal"><span class="pre">/images</span></code> within root.</p>
<div class="highlight-python"><div class="highlight"><pre>./nanshe_converter.py tiff config.json input_dir/*.tiff output.h5/images
</pre></div>
</div>
</div>
</div>
<div class="section" id="learner">
<h3>Learner<a class="headerlink" href="#learner" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Intro<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The next item contained inside the package is <code class="docutils literal"><span class="pre">nanshe_learner.py</span></code>.
This runs the segmentation algorithm using a specified set of parameters
on a provided dataset and stores the result.</p>
</div>
<div class="section" id="id2">
<h4>Sample Usage<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>To run the learner, simply run the command below. The configuration
parameters are contained in the <code class="docutils literal"><span class="pre">config.json</span></code> file. Sample
configuration files are included in the <code class="docutils literal"><span class="pre">examples</span></code> folder. One example
is for a single process and is called <code class="docutils literal"><span class="pre">nanshe_learner.json</span></code>. Another
example uses multiprocessing and is called
<code class="docutils literal"><span class="pre">nanshe_learner_multiprocessing.json</span></code>. The input data is stored within
the HDF5 <code class="docutils literal"><span class="pre">input.h5</span></code> in the top level group in the dataset <code class="docutils literal"><span class="pre">images</span></code>.
The output file can be the same file or a different file. Here,
<code class="docutils literal"><span class="pre">output.h5</span></code> is the output file. The data is stored in the specified
group, which is root as can be seen by the following <code class="docutils literal"><span class="pre">/</span></code>. The
extracted neurons will be put in a compound data type (a.k.a. a
structured array) called <code class="docutils literal"><span class="pre">neurons</span></code>. Various results including the
masks (under the field <code class="docutils literal"><span class="pre">mask</span></code>) will be stored here. The first index on
neurons will indicate which neuron is selected. All remaining indices
for different types follow C-order convention (excepting
<code class="docutils literal"><span class="pre">gaussian_cov</span></code>, which is the covariance matrix and slightly differs
for obvious reasons).</p>
<div class="highlight-python"><div class="highlight"><pre>./nanshe_learner.py config.json input.h5/images output.h5/
</pre></div>
</div>
</div>
</div>
<div class="section" id="viewer">
<h3>Viewer<a class="headerlink" href="#viewer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>Intro<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>The first item contained inside the package is <code class="docutils literal"><span class="pre">nanshe_viewer.py</span></code>.
This runs the segmentation algorithm using a specified set of parameters
on a provided dataset and stores the result.</p>
</div>
<div class="section" id="id4">
<h4>Sample Usage<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>To run the viewer, simply run the command below. The configuration
parameters are contained in the <code class="docutils literal"><span class="pre">config.json</span></code> file. These specify how
the layers are ordered, grouped, and named. Also, they specify where to
fetch the data for the layers. Lastly, they specify where this data is
located in an HDF5 file. The input data is stored within the HDF5
<code class="docutils literal"><span class="pre">input.h5</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre>./nanshe_viewer.py config.json input.h5
</pre></div>
</div>
</div>
</div>
<div class="section" id="prebuilt-binaries">
<h3>Prebuilt Binaries<a class="headerlink" href="#prebuilt-binaries" title="Permalink to this headline">¶</a></h3>
<p>There are some prebuilt binaries that are available. These are built
using BuildEM ( <a class="reference external" href="https://github.com/janelia-flyem/buildem">https://github.com/janelia-flyem/buildem</a> ). The binaries
are designed to be largely independent of your own system. These contain
all the dependencies needed to run everything used by Nanshe except for
the ones explicitly required and excluded from BuildEM.</p>
<p>To run any of the above utilities, there is a <code class="docutils literal"><span class="pre">run_*.sh</span></code> command that
will do this. For example, here is how you would call the
nanshe_learner.</p>
<div class="highlight-python"><div class="highlight"><pre>./nanshe-package/run_nanshe_learner.sh &quot;config.json&quot; &quot;input.h5/images&quot; &quot;output.h5/&quot;
</pre></div>
</div>
<p>It is also possible to submit jobs to cluster using the Open Grid
Engine, which have DRMAA installed. This is done using <code class="docutils literal"><span class="pre">qrun_*.sh</span></code>
commands as seen below. In the case of nanshe_learner, a special
configure file is required, which can be found in the example directory.
If DRMAA is not available, it is possible to run multiprocessing as
mentioned above.</p>
<div class="highlight-python"><div class="highlight"><pre>./nanshe-package/qrun_nanshe_learner.sh &quot;config.json&quot; &quot;input.h5/images&quot; &quot;output.h5/&quot;
</pre></div>
</div>
</div>
<div class="section" id="conventions">
<h3>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h3>
<p>Throughout nanshe, there are certain conventions that are followed.
Often it is not necessary to know them. However, they do occasionally
come up. For instances, Nanshe uses the C-order indexing convention and
does not use multiple channels. This means that the spatial ordering
will be transposed of what is usually expected and time will come first.
For a given 2D array, <code class="docutils literal"><span class="pre">a_2D</span></code>, indexing would be <code class="docutils literal"><span class="pre">a_2D[t,y,x]</span></code> where
<code class="docutils literal"><span class="pre">t</span></code> is time and <code class="docutils literal"><span class="pre">x</span></code>, <code class="docutils literal"><span class="pre">y</span></code> are the usual spatial coordinates.
Similarly, for a 3D array, <code class="docutils literal"><span class="pre">a_3D</span></code>, the indexing would be
<code class="docutils literal"><span class="pre">a_3D[t,z,y,x]</span></code>. Also, the JSON configuration files permit commenting.
This is done by using <code class="docutils literal"><span class="pre">__comment__</span></code> as a prefix within a string. For
objects (a.k.a. dictionaries), if the key or value has a comment both
will be removed on parsing. For arrays (a.k.a. lists), if a value is a
comment, it will be dropped from the list. Additionally, some steps are
optional, in which case they can be removed or commented from the
configuration file. For certain fields, like those in
&#8220;accepted_region_shape_constraints&#8221; and
&#8220;accepted_neuron_shape_constraints&#8221;, it is permissible to have a
&#8220;min&#8221; and/or &#8220;max&#8221;. If both are specified, then the range must be met.
If only one is specified, then only an upper or lower bound exists.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">README</a><ul>
<li><a class="reference internal" href="#nanshe">Nanshe</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#converter">Converter</a><ul>
<li><a class="reference internal" href="#intro">Intro</a></li>
<li><a class="reference internal" href="#sample-usage">Sample Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learner">Learner</a><ul>
<li><a class="reference internal" href="#id1">Intro</a></li>
<li><a class="reference internal" href="#id2">Sample Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#viewer">Viewer</a><ul>
<li><a class="reference internal" href="#id3">Intro</a></li>
<li><a class="reference internal" href="#id4">Sample Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prebuilt-binaries">Prebuilt Binaries</a></li>
<li><a class="reference internal" href="#conventions">Conventions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="index.html"
                          title="Previous page">&larr; Welcome to nanshe&#8217;s documentation!</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="nanshe.html"
                          title="Next page">&rarr; nanshe package</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/readme.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.html" title="nanshe package"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Welcome to nanshe’s documentation!"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">nanshe 0.1.0a29+7.gc825354 documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2015, John A. Kirkham.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>