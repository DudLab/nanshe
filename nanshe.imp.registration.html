

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>nanshe.imp.registration module &mdash; nanshe 0.1.0a22+11.g5df66bf documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0a22+11.g5df66bf',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="top" title="nanshe 0.1.0a22+11.g5df66bf documentation" href="index.html" />
    <link rel="next" title="nanshe.imp.renorm module" href="nanshe.imp.renorm.html" />
    <link rel="prev" title="nanshe.imp.filters.wavelet module" href="nanshe.imp.filters.wavelet.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.imp.renorm.html" title="nanshe.imp.renorm module"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.imp.filters.wavelet.html" title="nanshe.imp.filters.wavelet module"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">nanshe 0.1.0a22+11.g5df66bf documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-nanshe.imp.registration">
<span id="nanshe-imp-registration-module"></span><h1>nanshe.imp.registration module<a class="headerlink" href="#module-nanshe.imp.registration" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">registration</span></code> module helps bring image stacks into alignment.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The registration algorithm developed by Wenzhi Sun. The strategy uses an
area-based method for registration. Namely, it takes a template image (the mean
projection) and finds the translations required for each frame to overlap
optimally with the template image. Then a number of adjustments are made to the
shifts to ensure that unnecessary translations are not preformed.</p>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="nanshe.imp.registration.find_offsets">
<code class="descclassname">nanshe.imp.registration.</code><code class="descname">find_offsets</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nanshe/imp/registration.html#find_offsets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nanshe.imp.registration.find_offsets" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the convolution of the template with the frames by taking
advantage of their FFTs for faster computation that an ordinary
convolution ( O(N*lg(N)) vs O(N^2) )
&lt; <a class="reference external" href="http://ccrma.stanford.edu/~jos/ReviewFourier/FFT_Convolution_vs_Direct.html">http://ccrma.stanford.edu/~jos/ReviewFourier/FFT_Convolution_vs_Direct.html</a> &gt;.
Once computed the maximum of the convolution is found to determine the
best overlap of each frame with the template, which provides the needed
offset. Some corrections are performed to make reasonable offsets.</p>
<p class="rubric">Notes</p>
<p>Adapted from code provided by Wenzhi Sun with speed improvements
provided by Uri Dubin.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>frames2reg</strong> (<em>numpy.ndarray</em>) &#8211; image stack to register (time
is the first dimension uses
C-order tyx or tzyx).</li>
<li><strong>template_fft</strong> (<em>numpy.ndarray</em>) &#8211; what to register the image
stack against (single frame
using C-order yx or zyx).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">an array containing the
translations to apply to each
frame.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(numpy.ndarray)</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 1.,  1.,  1.,  1.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">af</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span><span class="p">));</span> <span class="n">af</span>
<span class="go">array([[[ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ]],</span>

<span class="go">       [[ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ]],</span>

<span class="go">       [[ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [-2.+3.46410162j,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [-2.-3.46410162j,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ]],</span>

<span class="go">       [[ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ]],</span>

<span class="go">       [[ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ],</span>
<span class="go">        [ 4.+0.j        ,  0.+0.j        ,  0.+0.j        ,  0.+0.j        ]]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tf</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">));</span> <span class="n">tf</span>
<span class="go">array([[ 4.0+0.j        ,  0.0+0.j        ,  0.0+0.j        ,  0.0+0.j        ],</span>
<span class="go">       [ 2.8+0.69282032j,  0.0+0.j        ,  0.0+0.j        ,  0.0+0.j        ],</span>
<span class="go">       [ 2.8-0.69282032j,  0.0+0.j        ,  0.0+0.j        ,  0.0+0.j        ]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">find_offsets</span><span class="p">(</span><span class="n">af</span><span class="p">,</span> <span class="n">tf</span><span class="p">)</span>
<span class="go">array([[ 0,  0],</span>
<span class="go">       [ 0,  0],</span>
<span class="go">       [-2,  0],</span>
<span class="go">       [ 0,  0],</span>
<span class="go">       [ 0,  0]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="nanshe.imp.registration.register_mean_offsets">
<code class="descclassname">nanshe.imp.registration.</code><code class="descname">register_mean_offsets</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nanshe/imp/registration.html#register_mean_offsets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nanshe.imp.registration.register_mean_offsets" title="Permalink to this definition">¶</a></dt>
<dd><p>This algorithm registers the given image stack against its mean
projection. This is done by computing translations needed to put each
frame in alignment. Then the translation is performed and new
translations are computed. This is repeated until no further
improvement can be made.</p>
<p>The code for translations can be found in find_mean_offsets.</p>
<p class="rubric">Notes</p>
<p>Adapted from code provided by Wenzhi Sun with speed improvements
provided by Uri Dubin.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>frames2reg</strong> (<em>numpy.ndarray</em>) &#8211; Image stack to register (time
is the first dimension uses
C-order tyx or tzyx).</li>
<li><strong>max_iters</strong> (<em>int</em>) &#8211; Number of iterations to allow
before forcing termination if
stable point is not found yet.
Set to -1 if no limit.
(Default -1)</li>
<li><strong>block_frame_length</strong> (<em>int</em>) &#8211; Number of frames to work with
at a time. By default all.
(Default -1)</li>
<li><strong>include_shift</strong> (<em>bool</em>) &#8211; Whether to return the shifts
used, as well. (Default False)</li>
<li><strong>to_truncate</strong> (<em>bool</em>) &#8211; Whether to truncate the frames
to remove all masked portions.
(Default False)</li>
<li><strong>float_type</strong> (<em>type</em>) &#8211; Type of float to use for
calculation. (Default
numpy.float64).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">an array containing the
translations to apply to each
frame.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(numpy.ndarray)</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 1.,  1.,  1.,  1.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]],</span>

<span class="go">       [[ 1.,  1.,  1.,  1.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.],</span>
<span class="go">        [ 0.,  0.,  0.,  0.]]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">register_mean_offsets</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">include_shift</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">(masked_array(data =</span>
<span class="go"> [[[1.0 1.0 1.0 1.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]]</span>

<span class="go"> [[1.0 1.0 1.0 1.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]]</span>

<span class="go"> [[-- -- -- --]</span>
<span class="go">  [0.0 0.0 0.0 0.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]]</span>

<span class="go"> [[1.0 1.0 1.0 1.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]]</span>

<span class="go"> [[1.0 1.0 1.0 1.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]</span>
<span class="go">  [0.0 0.0 0.0 0.0]]],</span>
<span class="go">             mask =</span>
<span class="go"> [[[False False False False]</span>
<span class="go">  [False False False False]</span>
<span class="go">  [False False False False]]</span>

<span class="go"> [[False False False False]</span>
<span class="go">  [False False False False]</span>
<span class="go">  [False False False False]]</span>

<span class="go"> [[ True  True  True  True]</span>
<span class="go">  [False False False False]</span>
<span class="go">  [False False False False]]</span>

<span class="go"> [[False False False False]</span>
<span class="go">  [False False False False]</span>
<span class="go">  [False False False False]]</span>

<span class="go"> [[False False False False]</span>
<span class="go">  [False False False False]</span>
<span class="go">  [False False False False]]],</span>
<span class="go">       fill_value = 0.0)</span>
<span class="go">, array([[0, 0],</span>
<span class="go">       [0, 0],</span>
<span class="go">       [1, 0],</span>
<span class="go">       [0, 0],</span>
<span class="go">       [0, 0]]))</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">nanshe.imp.registration module</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="nanshe.imp.filters.wavelet.html"
                          title="Previous page">&larr; nanshe.imp.filters.wavelet module</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="nanshe.imp.renorm.html"
                          title="Next page">&rarr; nanshe.imp.renorm module</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/nanshe.imp.registration.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.imp.renorm.html" title="nanshe.imp.renorm module"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="nanshe.imp.filters.wavelet.html" title="nanshe.imp.filters.wavelet module"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">nanshe 0.1.0a22+11.g5df66bf documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2014-2015, John A. Kirkham.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>